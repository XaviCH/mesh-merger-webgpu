(()=>{"use strict";var e,t,r,a,n={685:(e,t,r)=>{r.d(t,{Ib:()=>a,WT:()=>n});var a=1e-6,n="undefined"!=typeof Float32Array?Float32Array:Array;Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)})},975:(e,t,r)=>{r.d(t,{G3:()=>i,U1:()=>s,Ue:()=>n,zB:()=>o});var a=r(685);function n(){var e=new a.WT(16);return a.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function s(e,t,r,n){var s,i,o,c,l,h,u,f,d,m,v,p,g,b,x,y,w,U,C,B,E,O,A,M,P=n[0],T=n[1],I=n[2],S=Math.hypot(P,T,I);return S<a.Ib?null:(P*=S=1/S,T*=S,I*=S,s=Math.sin(r),o=1-(i=Math.cos(r)),c=t[0],l=t[1],h=t[2],u=t[3],f=t[4],d=t[5],m=t[6],v=t[7],p=t[8],g=t[9],b=t[10],x=t[11],y=P*P*o+i,w=T*P*o+I*s,U=I*P*o-T*s,C=P*T*o-I*s,B=T*T*o+i,E=I*T*o+P*s,O=P*I*o+T*s,A=T*I*o-P*s,M=I*I*o+i,e[0]=c*y+f*w+p*U,e[1]=l*y+d*w+g*U,e[2]=h*y+m*w+b*U,e[3]=u*y+v*w+x*U,e[4]=c*C+f*B+p*E,e[5]=l*C+d*B+g*E,e[6]=h*C+m*B+b*E,e[7]=u*C+v*B+x*E,e[8]=c*O+f*A+p*M,e[9]=l*O+d*A+g*M,e[10]=h*O+m*A+b*M,e[11]=u*O+v*A+x*M,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}var i=function(e,t,r,a,n){var s,i=1/Math.tan(t/2);return e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(s=1/(a-n),e[10]=(n+a)*s,e[14]=2*n*a*s):(e[10]=-1,e[14]=-2*a),e};function o(e,t,r,n){var s,i,o,c,l,h,u,f,d,m,v=t[0],p=t[1],g=t[2],b=n[0],x=n[1],y=n[2],w=r[0],U=r[1],C=r[2];return Math.abs(v-w)<a.Ib&&Math.abs(p-U)<a.Ib&&Math.abs(g-C)<a.Ib?function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(e):(u=v-w,f=p-U,d=g-C,s=x*(d*=m=1/Math.hypot(u,f,d))-y*(f*=m),i=y*(u*=m)-b*d,o=b*f-x*u,(m=Math.hypot(s,i,o))?(s*=m=1/m,i*=m,o*=m):(s=0,i=0,o=0),c=f*o-d*i,l=d*s-u*o,h=u*i-f*s,(m=Math.hypot(c,l,h))?(c*=m=1/m,l*=m,h*=m):(c=0,l=0,h=0),e[0]=s,e[1]=c,e[2]=u,e[3]=0,e[4]=i,e[5]=l,e[6]=f,e[7]=0,e[8]=o,e[9]=h,e[10]=d,e[11]=0,e[12]=-(s*v+i*p+o*g),e[13]=-(c*v+l*p+h*g),e[14]=-(u*v+f*p+d*g),e[15]=1,e)}},160:(e,t,r)=>{r.d(t,{AK:()=>f,EU:()=>m,Fv:()=>u,IH:()=>o,JG:()=>i,Jp:()=>c,TE:()=>h,TK:()=>g,Ue:()=>n,al:()=>s,cs:()=>l,dC:()=>p,kC:()=>d,lu:()=>v});var a=r(685);function n(){var e=new a.WT(3);return a.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function s(e,t,r){var n=new a.WT(3);return n[0]=e,n[1]=t,n[2]=r,n}function i(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function o(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function c(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function l(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function h(e,t){var r=t[0]-e[0],a=t[1]-e[1],n=t[2]-e[2];return Math.hypot(r,a,n)}function u(e,t){var r=t[0],a=t[1],n=t[2],s=r*r+a*a+n*n;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function f(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function d(e,t,r){var a=t[0],n=t[1],s=t[2],i=r[0],o=r[1],c=r[2];return e[0]=n*c-s*o,e[1]=s*i-a*c,e[2]=a*o-n*i,e}function m(e,t){var r=e[0],a=e[1],n=e[2],s=t[0],i=t[1],o=t[2],c=Math.sqrt(r*r+a*a+n*n)*Math.sqrt(s*s+i*i+o*o),l=c&&f(e,t)/c;return Math.acos(Math.min(Math.max(l,-1),1))}var v=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},p=c,g=h;n()},398:(e,t,r)=>{r.d(t,{R5:()=>a,U2:()=>n});const a=["cube","bunny","cow","chicken","rat","sphere","cube_deformed","wolf","tiger"];function n(e){return new Promise(((t,r)=>{var a=new XMLHttpRequest;a.open("GET","assets/"+e+".obj"),a.onreadystatechange=function(){4==this.readyState&&(200==this.status?t({name:e,data:this.responseText}):r("Error to load "+e+"."))},a.send()}))}Promise.all(a.map((e=>function(e){return new Promise(((t,r)=>{var a=new XMLHttpRequest;a.open("GET","assets/"+e+".obj"),a.onreadystatechange=function(){4==this.readyState&&(200==this.status?t({name:e,data:this.responseText}):r("Error to load "+e))},a.send()}))}(e)))).then((e=>{})).catch((e=>{console.log(e)}))},350:(e,t,r)=>{function a(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}r.d(t,{JQ:()=>i,TC:()=>n,k6:()=>s});const n=a('\n<div role="status" class="w-40 h-40 interactive-border flex justify-center items-center">\n    <svg aria-hidden="true" class="w-8 h-8 mr-2 text-gray-200 animate-spin dark:text-gray-600 fill-blue-600" viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z" fill="currentColor"/>\n        <path d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z" fill="currentFill"/>\n    </svg>\n</div>\n'),s=a('\n<div role="status" class="w-60 h-60 interactive-border flex justify-center items-center">\n    <svg aria-hidden="true" class="w-8 h-8 mr-2 text-gray-200 animate-spin dark:text-gray-600 fill-blue-600" viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z" fill="currentColor"/>\n        <path d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z" fill="currentFill"/>\n    </svg>\n</div>\n'),i=a('\n<div class="relative group interactive-border">\n    <canvas class="w-48 h-48">\n    </canvas>\n    <div class="absolute top-0 left-0 w-48 h-48 p-4 pt-8 items-center justify-center hidden group-hover:flex flex-wrap opacity-80">\n        <input id="default-range" type="range" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">\n        <button type="button" class="w-12 h-12 rounded hover:bg-gray-800">\n            <i class="fa fa-trash"></i>\n        </button>\n    </div>\n</div>\n')},225:(e,t,r)=>{r.a(e,(async(e,t)=>{try{var a=r(28),n=r(398),s=r(77),i=r(461),o=r(350),c=r(30),l=r(600),h=e([a,i,l]);[a,i,l]=h.then?(await h)():h;const f=[];function d(){f.splice(f.indexOf(this.parentElement.parentElement.scene),1),this.parentElement.parentElement.remove()}async function m(){const e=document.getElementById("mesh-frame-grid"),t=document.getElementById("add-mesh-frame");let r=o.k6.cloneNode(!0);e.insertBefore(r,t.nextSibling);let a=o.JQ.cloneNode(!0);a.children[1].children[1].onclick=d,document.getElementById("close-new-mesh").click();let n=new i.x(this.mesh,a.children[0]);a.scene=n,f.push(n),e.insertBefore(a,r),r.remove()}var u;n.R5.forEach((async e=>{const t=document.getElementById("new-mesh-wrap");let r=o.TC.cloneNode(!0);t.appendChild(r);let c=await n.U2(e),l=document.createElement("canvas");l.setAttribute("class","w-40 h-40 interactive-border"),l.onclick=m,l.mesh=s.K.fromString(c.data),a.il([new i.x(l.mesh,l)]),t.insertBefore(l,r),r.remove()})),document.getElementById("merge-button").onclick=()=>{let e=document.getElementById("main-scene");u=new l.V(new c.w(f.map((e=>e.mesh))),e)},function e(){if(a.il(f),u){for(let e=0;e<f.length;++e)u.scalars[e]=f[e].canvas.nextElementSibling.children[0].value/100;a.il([u])}requestAnimationFrame(e)}(),t()}catch(v){t(v)}}))},77:(e,t,r)=>{r.d(t,{K:()=>s});var a=r(160);class n{constructor(e,t,r,n){this.a=e,this.b=t,this.c=r,void 0===n?(this.normal=a.Ue(),this.normalize()):this.normal=n}normalize(){let e=a.Ue();a.lu(e,this.a,this.b);let t=a.Ue();a.lu(t,this.a,this.c),a.kC(this.normal,e,t);let r=a.Ue();a.Jp(r,this.normal,a.al(-1,-1,-1));let n=a.Ue(),s=a.Ue();a.IH(n,this.a,this.normal),a.IH(s,this.a,r),a.TK(s,a.al(0,0,0))>a.TK(n,a.al(0,0,0))&&a.IH(this.normal,r,a.al(0,0,0)),a.Fv(this.normal,this.normal)}copy(){return new n(this.a,this.b,this.c,a.JG(a.Ue(),this.normal))}contains(e){return this.a==e||this.b==e||this.c==e}calculateAnglesAtVertex(e){let t=[this.a,this.b,this.c].filter((t=>t!==e)),r=a.lu(a.Ue(),t[0],e),n=a.lu(a.Ue(),t[1],e);return a.EU(r,n)}calculateArea(){let e=[this.a,this.b,this.c];const t=a.TE(e[0],e[1]),r=a.TE(e[1],e[2]),n=a.TE(e[2],e[0]),s=(t+r+n)/2;return Math.sqrt(s*(s-t)*(s-r)*(s-n))}static and(e,t){let r=[t.a,t.b,t.c];return new Set([e.a,e.b,e.c].filter((e=>r.includes(e))))}static or(){return new Set(Array.from(arguments).reduce(((e,t)=>e.concat(t.a,t.b,t.c)),[]))}}class s{vertices=[];faces=[];vertex_size=6;generateVBO(){let e=[];return this.faces.forEach((t=>{e=e.concat(Array.from(t.a),Array.from(t.normal),Array.from(t.b),Array.from(t.normal),Array.from(t.c),Array.from(t.normal))})),new Float32Array(e)}static fromString(e){let t=new s,r=e.split(/[\r\n]+/g),i=[];return r.forEach((e=>{let r=e.trim().split(" "),s=r[0];if("v"==s)t.vertices.push(a.al(parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3])));else if("vn"==s)i.push(a.al(parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3])));else if("f"==s){let e=r[1].split("/"),a=r[2].split("/"),s=r[3].split("/");t.faces.push(new n(t.vertices[parseInt(e[0])-1],t.vertices[parseInt(a[0])-1],t.vertices[parseInt(s[0])-1],i[parseInt(e[2])-1]))}})),t.normalize(),t}normalize(){let e=this.vertices.reduce(((e,t)=>{let r=a.Ue();return a.IH(r,e,t),r}));a.cs(e,e,a.al(this.vertices.length,this.vertices.length,this.vertices.length));let t=a.Ue();a.Jp(t,e,a.al(-1,-1,-1)),this.vertices.forEach((e=>{a.IH(e,e,t)}));let r=a.al(0,0,0),n=this.vertices[0],s=Math.abs(a.TE(n,r));this.vertices.forEach((e=>{let t=Math.abs(a.TE(e,r));t>s&&(s=t,n=e)}));let i=a.Ue();a.cs(i,a.al(.5,.5,.5),a.al(s,s,s)),this.vertices.forEach((e=>{a.Jp(e,e,i)}))}copy(){let e=new s;return e.vertices=this.vertices.map((e=>a.JG(a.Ue(),e))),e.faces=this.faces.map((e=>e.copy())),e.faces.forEach((t=>{let r=this.vertices.indexOf(t.a),a=this.vertices.indexOf(t.b),n=this.vertices.indexOf(t.c);t.a=e.vertices[r],t.b=e.vertices[a],t.c=e.vertices[n]})),e}getNeighborsOfVertex(e){let t=new Set;for(const r of this.faces)r.contains(e)&&(t.add(r.a),t.add(r.b),t.add(r.c));return t.delete(e),t}spheralize(){let e=this.copy(),t=[],r=new Set(e.vertices);const s=t=>{let r=[],a=null;for(let n of t.values()){let t=[];for(let r of e.faces)if(r.contains(n)&&(t.push(r),t.length>5))break;if(3==t.length)return{vertex:n,faces:t};(0==r.length||t.length<r.length)&&(r=t,a=n)}return{vertex:a,faces:r}};for(;e.faces.length>4;){let a=s(r),i=a.vertex,o=a.faces;r.delete(i),o.forEach((t=>{let r=e.faces.indexOf(t);e.faces.splice(r,1)}));let c=[];if(3==o.length){let e=n.or(...o);e.delete(i),c.push(new n(...Array.from(e)))}else if(4==o.length){let e=n.or(...o);e.delete(i);let t=e.values().next().value;e.delete(t);let r=Array.from(e).find((e=>2==o.filter((r=>r.contains(e)&&!r.contains(t))).length));e.delete(r),e=Array.from(e),c.push(new n(t,...e)),c.push(new n(r,...e))}else{if(5!=o.length)throw new Error("Not a valid mesh.");{let e=n.or(...o);e.delete(i);let t=e.values().next().value;e.delete(t);let r=Array.from(e).filter((e=>2==o.filter((r=>r.contains(e)&&!r.contains(t))).length));r.forEach((t=>e.delete(t))),c.push(new n(t,...r)),Array.from(e).forEach((e=>{let a=r.find((t=>null!=o.find((r=>r.contains(e)&&r.contains(t)))));c.push(new n(t,e,a))}))}}c.forEach((t=>e.faces.push(t))),t.push({vertex:i,oldFaces:o,newFaces:c})}let i=Array.from(r);for(a.IH(i[0],a.al(-1,-1,-1),a.al(0,0,0)),a.IH(i[1],a.al(-1,1,1),a.al(0,0,0)),a.IH(i[2],a.al(1,-1,1),a.al(0,0,0)),a.IH(i[3],a.al(1,1,-1),a.al(0,0,0)),i.forEach((e=>{a.Fv(e,e),a.Jp(e,e,a.al(.5,.5,.5))})),e.faces.forEach((e=>{e.normalize()}));t.length>0;){let r=t.pop(),n=r.vertex,s=r.newFaces,i=r.oldFaces;s.forEach((t=>{e.faces.splice(e.faces.indexOf(t),1)})),i.forEach((t=>{e.faces.push(t)}));let o=new Set;i.forEach((e=>{o.add(e.a),o.add(e.b),o.add(e.c)})),o.delete(n),o=Array.from(o),o.reduce(((e,t)=>a.IH(n,e,t)),a.al(0,0,0)),a.Fv(n,n),a.Jp(n,n,a.al(.5,.5,.5)),i.forEach((e=>{e.normalize()}))}return e}steps(){let e=this.copy();const t=e.faces.reduce(((e,t)=>e+t.calculateArea()),0)/e.faces.length;function r(e,r){let a=e.faces.filter((e=>e.contains(r))),s=n.or(...a);s.delete(r),s=[...s];let i=a.reduce(((e,t)=>e+t.calculateAnglesAtVertex(r)),0),o=a.reduce(((e,t)=>e+t.calculateArea()),0);return(2*Math.PI-i)/(t+o/3)}function s(e,t){let r=e.getNeighborsOfVertex(t),n=a.Ue(),s=r.size;return r.forEach((e=>a.IH(n,n,e))),a.cs(n,n,a.al(s,s,s)),n}let i=5*e.vertices.length,o=!1;for(;0!=i&&!o;){i-=1,o=!0,e.vertices.forEach((t=>t.gaussianCurvature=r(e,t)));let t=[...e.vertices].sort(((e,t)=>t.gaussianCurvature<0&&e.gaussianCurvature>0?1:t.gaussianCurvature>0&&e.gaussianCurvature<0?-1:Math.abs(t.gaussianCurvature)-Math.abs(e.gaussianCurvature)));if(t[0].gaussianCurvature>=0)break;for(let r of t){let t=s(e,r);if(a.TE(t,r)>.001){a.JG(r,t),o=!1;break}}}return e.normalize(),e.vertices.forEach((e=>{a.Fv(e,e),a.Jp(e,e,a.al(.5,.5,.5))})),e}readFile(e){const t=new FileReader;t.onload=()=>{},t.readAsText(e)}}},30:(e,t,r)=>{r.d(t,{w:()=>c});var a=r(160);function n(e,t,r,n){return 1/6*a.AK(a.kC(a.Ue(),a.lu(a.Ue(),t,e),a.lu(a.Ue(),r,e)),a.lu(a.Ue(),n,e))}function s(e,t){let r=a.al(0,0,0),s=n(t,r,e.a,e.b)>=0;return n(t,e.a,e.b,e.c)>=0!=n(r,e.a,e.b,e.c)>=0&&s==n(t,r,e.b,e.c)>=0&&s==n(t,r,e.c,e.a)>=0}function i(e,t){let r=a.lu(a.Ue(),e.b,e.a),n=a.lu(a.Ue(),e.c,e.a),s=a.Fv(a.Ue(),a.kC(a.Ue(),r,n)),i=(a.AK(s,e.a)-a.AK(s,t))/a.AK(s,s),o=a.IH(a.Ue(),t,a.dC(a.Ue(),s,a.al(i,i,i)));a.AK(r,r),a.AK(n,n),a.AK(r,n);return a.AK(a.lu(a.Ue(),o,e.a),r),a.AK(a.lu(a.Ue(),o,e.a),n),a.AK(a.lu(a.Ue(),o,e.a),n),a.AK(a.lu(a.Ue(),o,e.a),r),o}function o(e,t,r){let n=function(e,t){let r=a.lu(a.Ue(),t.b,t.a),n=a.lu(a.Ue(),t.c,t.a),s=a.lu(a.Ue(),e,t.a),i=a.AK(r,r),o=a.AK(r,n),c=a.AK(n,n),l=a.AK(s,r),h=a.AK(s,n),u=i*c-o*o,f=(c*l-o*h)/u,d=(i*h-o*l)/u;return[1-f-d,f,d]}(e,t),s=n[0],i=n[1],o=n[2];return a.IH(a.Ue(),a.IH(a.Ue(),a.dC(a.Ue(),r.a,a.al(s,s,s)),a.dC(a.Ue(),r.b,a.al(i,i,i))),a.dC(a.Ue(),r.c,a.al(o,o,o)))}class c{vertices=[];faces=[];meshes=[];vertex_size;constructor(e){this.vertex_size=6+3*e.length*2,this.meshes=e;let t=e.map((e=>e.steps()));for(let r=0;r<e[0].vertices.length;++r)this.vertices.push({vertex:t[0].vertices[r],directions:[a.lu(a.Ue(),e[0].vertices[r],t[0].vertices[r])]});t[0].faces.forEach((r=>{let n=t[0].vertices.indexOf(r.a),s=t[0].vertices.indexOf(r.b),i=t[0].vertices.indexOf(r.c),o=this.meshes[0].faces.find((t=>{let r=new Set([n,s,i]);return r.add(e[0].vertices.indexOf(t.a)),r.add(e[0].vertices.indexOf(t.b)),r.add(e[0].vertices.indexOf(t.c)),3==r.size}));this.faces.push({a:this.vertices[n],b:this.vertices[s],c:this.vertices[i],normal:{base:r.normal,directions:[a.lu(a.Ue(),o.normal,r.normal)]}})}));for(let r=1;r<e.length;++r){let n=[],c=[];for(let c=0;c<e[r].vertices.length;++c){let l=this.faces.find((e=>s({a:e.a.vertex,b:e.b.vertex,c:e.c.vertex},t[r].vertices[c]))),h=i({a:l.a.vertex,b:l.b.vertex,c:l.c.vertex},t[r].vertices[c]),u=[];for(let e=0;e<l.a.directions.length;++e){let n=o(h,{a:l.a.vertex,b:l.b.vertex,c:l.c.vertex},{a:a.IH(a.Ue(),l.a.vertex,l.a.directions[e]),b:a.IH(a.Ue(),l.b.vertex,l.b.directions[e]),c:a.IH(a.Ue(),l.c.vertex,l.c.directions[e])});u.push(a.lu(a.Ue(),n,t[r].vertices[c]))}n.push({vertex:t[r].vertices[c],directions:[...u,a.lu(a.Ue(),e[r].vertices[c],t[r].vertices[c])]})}t[r].faces.forEach((s=>{let i=t[r].vertices.indexOf(s.a),o=t[r].vertices.indexOf(s.b),l=t[r].vertices.indexOf(s.c),h=this.meshes[r].faces.find((t=>{let a=new Set([i,o,l]);return a.add(e[r].vertices.indexOf(t.a)),a.add(e[r].vertices.indexOf(t.b)),a.add(e[r].vertices.indexOf(t.c)),3==a.size}));c.push({a:n[i],b:n[o],c:n[l],normal:{base:s.normal,directions:[a.Ue(),a.lu(a.Ue(),h.normal,s.normal)]}})})),this.vertices.forEach((n=>{let c=t[r].faces.find((e=>s(e,n.vertex))),l=t[r].vertices.indexOf(c.a),h=t[r].vertices.indexOf(c.b),u=t[r].vertices.indexOf(c.c),f=this.meshes[r].faces.find((t=>{let a=new Set([l,h,u]);return a.add(e[r].vertices.indexOf(t.a)),a.add(e[r].vertices.indexOf(t.b)),a.add(e[r].vertices.indexOf(t.c)),3==a.size})),d=o(i(c,n.vertex),c,f);n.directions.push(a.lu(a.Ue(),d,n.vertex))})),this.faces.forEach((e=>{e.normal.directions.push(a.Ue())})),this.vertices=this.vertices.concat(n),this.faces=this.faces.concat(c)}}generateVBO(){let e=[];return this.faces.forEach((t=>{e=e.concat(Array.from(t.a.vertex),t.a.directions.reduce(((e,t)=>e.concat(t[0],t[1],t[2])),[]),Array.from(t.normal.base),t.normal.directions.reduce(((e,t)=>e.concat(t[0],t[1],t[2])),[]),Array.from(t.b.vertex),t.b.directions.reduce(((e,t)=>e.concat(t[0],t[1],t[2])),[]),Array.from(t.normal.base),t.normal.directions.reduce(((e,t)=>e.concat(t[0],t[1],t[2])),[]),Array.from(t.c.vertex),t.c.directions.reduce(((e,t)=>e.concat(t[0],t[1],t[2])),[]),Array.from(t.normal.base),t.normal.directions.reduce(((e,t)=>e.concat(t[0],t[1],t[2])),[]))})),new Float32Array(e)}}},600:(e,t,r)=>{r.a(e,(async(e,a)=>{try{r.d(t,{V:()=>o});var n=r(28),s=r(975),i=e([n]);n=(i.then?(await i)():i)[0];class o{constructor(e,t){this.mesh=e,this.canvas=t,this.context=t.getContext("webgpu"),this.context.configure({device:n.Uh,format:n.p5,alphaMode:"premultiplied"}),this.VBO=e.generateVBO(),this.VBOBuffer=n.Uh.createBuffer({size:this.VBO.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),n.Uh.queue.writeBuffer(this.VBOBuffer,0,this.VBO),this.VBOBufferLayout={arrayStride:24+3*e.meshes.length*4*2,attributes:[{format:"float32x3",offset:0,shaderLocation:0},...e.meshes.map((t=>({format:"float32x3",offset:12+3*e.meshes.indexOf(t)*4,shaderLocation:e.meshes.indexOf(t)+1}))),{format:"float32x3",offset:12+3*e.meshes.length*4,shaderLocation:e.meshes.length+1},...e.meshes.map((t=>({format:"float32x3",offset:12+3*e.meshes.length*4+3*e.meshes.indexOf(t)*4+12,shaderLocation:e.meshes.length+e.meshes.indexOf(t)+2})))]},this.shaderModule=this.createShaderModule(),this.projection=s.Ue(),s.G3(this.projection,Math.PI/4,1,.1,10),this.view=s.Ue(),s.zB(this.view,[0,.75,1.5],[0,0,0],[0,1,0]),this.model=s.Ue(),this.scalars=new Float32Array(e.meshes.map((e=>0))),this.uniformBuffer=n.Uh.createBuffer({size:208,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.bindGroupLayout=n.Uh.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}}]}),this.bindGroup=n.Uh.createBindGroup({layout:this.bindGroupLayout,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]}),this.pipelineLayout=n.Uh.createPipelineLayout({bindGroupLayouts:[this.bindGroupLayout]}),this.renderPipeline=n.Uh.createRenderPipeline({layout:this.pipelineLayout,vertex:{module:this.shaderModule,entryPoint:"vertexMain",buffers:[this.VBOBufferLayout]},fragment:{module:this.shaderModule,entryPoint:"fragmentMain",targets:[{format:n.p5}]},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}})}createShaderModule(){let e=this.mesh.meshes.map((e=>`scalar${this.mesh.meshes.indexOf(e)}: f32`)).join(","),t=this.mesh.meshes.map((e=>{let t=this.mesh.meshes.indexOf(e);return`@location(${t+1}) direction${t}: vec3f`})).join(","),r=this.mesh.meshes.map((e=>{let t=this.mesh.meshes.indexOf(e);return`direction${t}*transformations.scalar${t}`})).join("+"),a=this.mesh.meshes.map((e=>{let t=this.mesh.meshes.indexOf(e);return`@location(${this.mesh.meshes.length+t+2}) normal${t}: vec3f`})).join(","),s=this.mesh.meshes.map((e=>{let t=this.mesh.meshes.indexOf(e);return`normal${t}*transformations.scalar${t}`})).join("+");return n.Uh.createShaderModule({code:`\n                struct TransformData {\n                    model: mat4x4f,\n                    view: mat4x4f,\n                    projection: mat4x4<f32>,\n                    ${e}\n                }\n        \n                struct Fragment {\n                    @builtin(position) Position: vec4f,\n                    @location(0) Color: vec4f\n                };\n        \n                @binding(0) @group(0) var<uniform> transformations: TransformData;\n        \n                @vertex\n                fn vertexMain(@location(0) pos: vec3f, ${t}, @location(${this.mesh.meshes.length+1}) normal : vec3f, ${a} ) -> Fragment {\n                    var output: Fragment;\n                    var finalPos: vec3f = pos + ${r};\n                    output.Position = transformations.projection * transformations.view * transformations.model * vec4f(finalPos, 1);\n                    var finalNormal: vec3f = normalize(normal + ${s});\n                    output.Color = vec4f((finalNormal+1)/2, 1);\n                    return output;\n                }\n        \n        \n                @fragment\n                fn fragmentMain(@location(0) Color: vec4f) -> @location(0) vec4f {\n                    return Color;\n                }\n            `})}update(){n.Uh.queue.writeBuffer(this.uniformBuffer,0,this.model),n.Uh.queue.writeBuffer(this.uniformBuffer,64,this.view),n.Uh.queue.writeBuffer(this.uniformBuffer,128,this.projection),n.Uh.queue.writeBuffer(this.uniformBuffer,192,new Float32Array(this.scalars)),s.U1(this.model,this.model,.005,[0,1,0])}}a()}catch(e){a(e)}}))},28:(e,t,r)=>{r.a(e,(async(e,a)=>{try{if(r.d(t,{Uh:()=>s,il:()=>o,p5:()=>i}),!navigator.gpu)throw new Error("WebGPU not supported on this browser.");const n=await navigator.gpu.requestAdapter();if(!n)throw new Error("No appropriate GPUAdapter found.");const s=await n.requestDevice(),i=navigator.gpu.getPreferredCanvasFormat();function o(e){let t=s.createCommandEncoder();e.forEach((e=>{e.update();let r=s.createTexture({size:[e.canvas.width,e.canvas.height,1],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),a=t.beginRenderPass({colorAttachments:[{view:e.context.getCurrentTexture().createView(),loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0},storeOp:"store"}],depthStencilAttachment:{view:r.createView(),depthLoadValue:1,depthLoadOp:"clear",depthClearValue:1,depthStoreOp:"store"}});a.setPipeline(e.renderPipeline),a.setVertexBuffer(0,e.VBOBuffer),a.setBindGroup(0,e.bindGroup),a.draw(e.VBO.length/e.mesh.vertex_size),a.end()})),s.queue.submit([t.finish()])}a()}catch(c){a(c)}}),1)},461:(e,t,r)=>{r.a(e,(async(e,a)=>{try{r.d(t,{x:()=>c});var n=r(28),s=r(975),i=e([n]);const o=(n=(i.then?(await i)():i)[0]).Uh.createShaderModule({code:"\n        struct TransformData {\n            model: mat4x4f,\n            view: mat4x4f,\n            projection: mat4x4<f32>,\n        }\n\n        struct Fragment {\n            @builtin(position) Position: vec4f,\n            @location(0) Color: vec4f\n        };\n\n        @binding(0) @group(0) var<uniform> transformations: TransformData;\n\n        @vertex\n        fn vertexMain(@location(0) pos: vec3f, @location(1) normal : vec3f) -> Fragment {\n            var output: Fragment;\n            output.Position = transformations.projection * transformations.view * transformations.model * vec4f(pos, 1);\n            output.Color = vec4f((normal+1)/2, 1);\n            return output;\n        }\n\n\n        @fragment\n        fn fragmentMain(@location(0) Color: vec4f) -> @location(0) vec4f {\n            return Color;\n        }\n    "});class c{constructor(e,t){this.mesh=e,this.canvas=t,this.context=t.getContext("webgpu"),this.context.configure({device:n.Uh,format:n.p5,alphaMode:"premultiplied"}),this.VBO=e.generateVBO(),this.VBOBuffer=n.Uh.createBuffer({size:this.VBO.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),n.Uh.queue.writeBuffer(this.VBOBuffer,0,this.VBO),this.VBOBufferLayout={arrayStride:24,attributes:[{format:"float32x3",offset:0,shaderLocation:0},{format:"float32x3",offset:12,shaderLocation:1}]},this.shaderModule=o,this.projection=s.Ue(),s.G3(this.projection,Math.PI/4,1,.1,10),this.view=s.Ue(),s.zB(this.view,[0,.75,1.5],[0,0,0],[0,1,0]),this.model=s.Ue(),this.uniformBuffer=n.Uh.createBuffer({size:192,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.bindGroupLayout=n.Uh.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}}]}),this.bindGroup=n.Uh.createBindGroup({layout:this.bindGroupLayout,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]}),this.pipelineLayout=n.Uh.createPipelineLayout({bindGroupLayouts:[this.bindGroupLayout]}),this.renderPipeline=n.Uh.createRenderPipeline({layout:this.pipelineLayout,vertex:{module:this.shaderModule,entryPoint:"vertexMain",buffers:[this.VBOBufferLayout]},fragment:{module:this.shaderModule,entryPoint:"fragmentMain",targets:[{format:n.p5}]},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}})}update(){n.Uh.queue.writeBuffer(this.uniformBuffer,0,this.model),n.Uh.queue.writeBuffer(this.uniformBuffer,64,this.view),n.Uh.queue.writeBuffer(this.uniformBuffer,128,this.projection),s.U1(this.model,this.model,.005,[0,1,0])}}a()}catch(e){a(e)}}))}},s={};function i(e){var t=s[e];if(void 0!==t)return t.exports;var r=s[e]={exports:{}};return n[e](r,r.exports,i),r.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",r="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",a=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},i.a=(n,s,i)=>{var o;i&&((o=[]).d=-1);var c,l,h,u=new Set,f=n.exports,d=new Promise(((e,t)=>{h=t,l=e}));d[t]=f,d[e]=e=>(o&&e(o),u.forEach(e),d.catch((e=>{}))),n.exports=d,s((n=>{var s;c=(n=>n.map((n=>{if(null!==n&&"object"==typeof n){if(n[e])return n;if(n.then){var s=[];s.d=0,n.then((e=>{i[t]=e,a(s)}),(e=>{i[r]=e,a(s)}));var i={};return i[e]=e=>e(s),i}}var o={};return o[e]=e=>{},o[t]=n,o})))(n);var i=()=>c.map((e=>{if(e[r])throw e[r];return e[t]})),l=new Promise((t=>{(s=()=>t(i)).r=0;var r=e=>e!==o&&!u.has(e)&&(u.add(e),e&&!e.d&&(s.r++,e.push(s)));c.map((t=>t[e](r)))}));return s.r?l:i()}),(e=>(e?h(d[r]=e):l(f),a(o)))),o&&o.d<0&&(o.d=0)},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i(225)})();